<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Private Metadata Scrubber</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding-top: 50px; background: #f4f7f6; }
        #drop-zone { width: 400px; height: 200px; border: 3px dashed #007bff; border-radius: 20px; display: flex; align-items: center; justify-content: center; background: white; cursor: pointer; transition: 0.3s; }
        #drop-zone:hover { background: #e9f2ff; }
        .status { margin-top: 20px; font-weight: bold; color: #555; }
    </style>
</head>
<body>
    <h1>Universal Metadata Scrubber</h1>
    <p>Upload Images, PDFs, Videos, or Audio to strip metadata locally.</p>
    
    <div id="drop-zone" onclick="document.getElementById('fileInput').click()">
        Drag & Drop or Click to Upload
    </div>
    <input type="file" id="fileInput" style="display:none" multiple onchange="handleFiles(this.files)">
    
    <div class="status" id="status">Ready</div>

    <script>
        const WEBHOOK_URL = 'http://localhost:5678/webhook/scrub-file'; // Use your PRODUCTION URL

        async function handleFiles(files) {
            const status = document.getElementById('status');
            
            for (let file of files) {
                status.innerText = `Processing: ${file.name}...`;
                let formData = new FormData();
                formData.append('data', file); // 'data' must match your n8n binary property

                try {
                    const response = await fetch(WEBHOOK_URL, { method: 'POST', body: formData });
                    if (!response.ok) throw new Error('Backend error');
                    
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `clean_${file.name}`;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                } catch (err) {
                    alert(`Error processing ${file.name}. Is n8n active?`);
                }
            }
            status.innerText = "All files processed!";
        }
    </script>
</body>
</html>